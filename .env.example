# ===================================
# DOCKER SETUP - INCLUDED SERVICES
# ===================================
# For `docker-compose up` with PostgreSQL and Qdrant containers
# Copy to .env and configure your values

# Core Application
NODE_ENV=production
PAYLOAD_SECRET=your_long_random_secret_here_min_32_chars
PAYLOAD_URL=http://localhost:3000
NEXT_PUBLIC_PAYLOAD_URL=http://localhost:3000

# Docker Database (uses container name as hostname)
DATABASE_URI=postgres://knowledge_user:your_password@postgres:5432/knowledge_base
DB_PASSWORD=your_password

# AI Services (Optional but recommended)
OPENAI_API_KEY=sk-your-openai-key-here
GEMINI_API_KEY=your-gemini-key-here
MISTRAL_API_KEY=your-mistral-key-here
PDF_EXTRACTOR=mistral

# Google Search Grounding (Optional - enables real-time web search in AI chat)
# Requires GEMINI_API_KEY to be configured
# When enabled, users can toggle Google Search in chat settings to enhance responses with current web information
GEMINI_GROUNDING_ENABLED=true

# Custom context string to add to Google Search queries (e.g., "falkenbergs kommun")
# This helps localize Google Search results to your organization/region
# Leave empty if you want generic global search results
GEMINI_GROUNDING_CONTEXT="falkenbergs kommun"

# AI Model Configuration
# WARNING: Only change models within the same provider to avoid API compatibility issues
# Gemini Flash model for OCR, metadata generation, and chat
GEMINI_FLASH_MODEL=gemini-flash-latest
# Imagen model for AI-generated cover photos
GEMINI_IMAGEN_MODEL=imagen-4.0-fast-generate-001
# Mistral OCR model for document processing
MISTRAL_OCR_MODEL=mistral-ocr-latest
# OpenAI embedding model for vector search
# CRITICAL: Changing this will invalidate all existing embeddings in Qdrant!
# Only change if you plan to re-embed all documents with sync:qdrant
OPENAI_EMBEDDING_MODEL=text-embedding-3-large

# Docker Vector Database (uses container name as hostname)
QDRANT_ENABLED=true
QDRANT_URL=http://qdrant:6333
QDRANT_API_KEY=  # Leave empty for local Docker Qdrant (no auth needed)

# ============================================
# EXTERNAL QDRANT SOURCES (OPTIONAL)
# ============================================
# Add external Qdrant collections as searchable sources in the chatbot.
#
# RECOMMENDED: Use external-sources.config.json file (easier to edit)
# Copy external-sources.config.example.json to external-sources.config.json and edit it.
#
# ALTERNATIVE: Use EXTERNAL_QDRANT_SOURCES environment variable (harder to maintain)
# Configured as a minified JSON array of source objects.
#
# CRITICAL REQUIREMENT: External Qdrant collections MUST use text-embedding-3-large (3072 dimensions)
# to match the internal collection's embedding model. Incompatible models cannot be searched together.
#
# SOURCE TYPES:
#
# 1. Standard Qdrant Source (type: "qdrant" - optional, default)
#    - Basic external Qdrant collection
#    - No hierarchical filtering
#
# 2. Hierarchical Qdrant Source (type: "hierarchical-qdrant")
#    - Qdrant collection with filterable sub-sources
#    - Users can expand and select specific sub-categories (e.g., individual laws)
#    - Requires: mapping.filterField, subSources array
#
# Common fields (all types):
#   - id: Unique identifier (alphanumeric, no spaces)
#   - type: Source type ("qdrant" or "hierarchical-qdrant") - optional, defaults to "qdrant"
#   - label: Display name in UI
#   - icon: Emoji or icon for UI (e.g., "üîí", "üåê", "‚öñÔ∏è")
#   - color: Badge color ("blue", "green", "red", "purple", "yellow")
#   - enabled: Set to false to temporarily disable (default: true)
#
# Qdrant-based sources (all types):
#   - collection: Qdrant collection name
#   - qdrantUrl: Full Qdrant URL (e.g., https://qdrant.example.com:6333)
#   - qdrantApiKey: API key for authentication
#   - mapping: Field mappings for extracting data from Qdrant payload
#     - url: Path to URL field (e.g., "metadata.source_url") - must be full URL
#     - title: Path to title field (e.g., "metadata.title")
#     - content: Path to content field (e.g., "content")
#     - description: Path to description field (optional)
#     - updatedAt: Path to timestamp field (optional)
#
# Hierarchical sources (type: "hierarchical-qdrant") additional fields:
#   - mapping.filterField: Qdrant field path to filter by (e.g., "metadata.law_id")
#   - subSources: Array of sub-source objects with {id, label}
#
# Example (minified - use online JSON minifier):
# EXTERNAL_QDRANT_SOURCES='[{"id":"example","collection":"ExampleCollection","label":"Example Source","qdrantUrl":"https://qdrant.example.com:6333","qdrantApiKey":"your-key","urlBase":"https://example.com","mapping":{"url":"metadata.url","title":"metadata.title","content":"content"},"icon":"üìö","color":"blue"}]'

# Example (pretty-printed for readability - MINIFY before use):
# EXTERNAL_QDRANT_SOURCES='
# [
#   {
#     "id": "intranet",
#     "type": "qdrant",
#     "collection": "IntranetDocs_RAG",
#     "label": "Intranet",
#     "qdrantUrl": "https://qdrant.example.com:6333",
#     "qdrantApiKey": "your-api-key-here",
#     "urlBase": "https://intranet.example.com",
#     "mapping": {
#       "url": "metadata.source_url",
#       "title": "metadata.title",
#       "content": "content"
#     },
#     "icon": "üîí",
#     "color": "blue"
#   },
#   {
#     "id": "public",
#     "type": "qdrant",
#     "collection": "PublicWebsite_RAG",
#     "label": "Public Website",
#     "qdrantUrl": "https://qdrant.example.com:6333",
#     "qdrantApiKey": "your-api-key-here",
#     "urlBase": "https://www.example.com",
#     "mapping": {
#       "url": "metadata.url",
#       "title": "metadata.title",
#       "content": "content"
#     },
#     "icon": "üåê",
#     "color": "green"
#   },
#   {
#     "id": "svensk-lag",
#     "type": "hierarchical-qdrant",
#     "collection": "SwedishLaw_RAG",
#     "label": "Svensk lag",
#     "qdrantUrl": "https://qdrant.example.com:6333",
#     "qdrantApiKey": "your-api-key-here",
#     "urlBase": "https://lagen.nu",
#     "mapping": {
#       "url": "metadata.source_url",
#       "title": "metadata.title",
#       "content": "content",
#       "filterField": "metadata.law_id"
#     },
#     "icon": "‚öñÔ∏è",
#     "color": "purple",
#     "subSources": [
#       {"id": "milj√∂balken", "label": "Milj√∂balken (1998:808)"},
#       {"id": "pbl", "label": "Plan- och bygglagen (2010:900)"},
#       {"id": "f√∂rvaltningslagen", "label": "F√∂rvaltningslagen (2017:900)"},
#       {"id": "kommunallagen", "label": "Kommunallagen (2017:725)"},
#       {"id": "osl", "label": "Offentlighets- och sekretesslagen (2009:400)"},
#       {"id": "tryckfrihetsf√∂rordningen", "label": "Tryckfrihetsf√∂rordningen"},
#       {"id": "arkivlagen", "label": "Arkivlagen (1990:782)"}
#     ]
#   }
# ]
# '
#
# NOTE: For Google Search integration, use the GEMINI_GROUNDING_ENABLED environment variable instead.

# Email Provider (Optional - for password reset & verification emails)
# Without email config, emails will be written to console (dev mode)
# Uncomment and configure one of the following providers:

# Resend (Recommended - https://resend.com)
# EMAIL_FROM=noreply@yourdomain.com
# EMAIL_FROM_NAME=Kunskapsportal
# RESEND_API_KEY=re_your_api_key_here

# SMTP (Generic email provider)
# EMAIL_FROM=noreply@yourdomain.com
# EMAIL_FROM_NAME=Kunskapsportal
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=your_smtp_username
# SMTP_PASS=your_smtp_password

# Production Settings
NEXT_TELEMETRY_DISABLED=1
NODE_OPTIONS="--max-old-space-size=2048"